# DLS Face Recognition project

Данный репозиторий представляет собой структуру проекта по задаче распознавания лиц

## Структура проекта 
│   .gitignore \
│   AllStaff.py - все необходимые функции для полного выполнения пайплайна распознавания лиц\
│   models.py - код моделей для импорта и использования в пайплайне\
│   Task2.ipynb - Задание 2, обучение моделей классификации\
│   Task3.ipynb - задание 3, примеры использования пайплайна\
│   requirements.txt - файл с необходимыми для корректной работы кода во всех блокнотах и скриптах\
│\
├───datasets - папка с csv файлами сохраненных датасетов\
│       │processed_test_dataset.csv\
│       │processed_train_dataset.csv\
│       │processed_val_dataset.csv\
│       │test_aligned.csv\
│       │train_aligned.csv\
│       │val_aligned.csv\
│\
├───task 1 - задание 1, отбор фотографий + stacked hourglass network\
│   │   dataset_prepare.ipynb - отбор фотографий\
│   │   hourglass and align.ipynb - блокнот с обучением stacked hourglass и афинным преобразованием фотографий\  
│\
├───weights\
│       │best_final_arc.pth - веса лучшей сохраненной модели с 3 этапа arcface\
│       │best_final_ce.pth - веса лучшей сохраненной модели с 3 этапа CE\
│       │best_stage1_arc.pth - веса лучшей сохраненной модели с 1 этапа arcface\
│       │best_stage1_ce.pth - веса лучшей сохраненной модели с 1 этапа CE\
│       │best_stage2_arc.pth - веса лучшей сохраненной модели со 2 этапа arcface\
│       │best_stage2_ce.pth - веса лучшей сохраненной модели со 2 этапа CE\
│       │final_arc_model.pth - веса лучшей итоговой модели arcface, используются в пайплайне\
│       │final_ce_model.pth - веса лучшей итоговой модели CE, используются в пайплайне\
│       │hourglass_model.pth - веса лучшей hourglass модели, используются в пайплайне\
│       │yolov8n-face.pt - веса предобученной на детекцию лиц модели yolov8, используются в пайплайне


'. . ._aligned' - датасеты, содержащие оригинальные названия картинок, id личности, изображенной на ней и пути к выровненным изображениям, который использовался мной для обучения.\
'processed_. . .' - датасеты содержащие оригинальное название, личность, параметры bbox, относительные координаты ключевых точек и пути к оригинальным изображениям.


## Использование
Веса моделей можно установить по ссылке - https://drive.google.com/drive/folders/1BJrTebLlIZjTROwX2EyM8EFcWOGJf8YF?usp=sharing       

В пайплайне используются 'weights\final_ce_model.pth' и 'weights\final_arc_model' в зависимости от выбранного флага use_arcface, 'weights\yolov8n-face' для модели детекции и 'weights\hourglass_model' для модели поиска точек - это является минимальным скачиваемым набором для запуска пайплайна.

Также следует удостовериться, что у вас установлены все необходимые сторонние библиотеки. Установить их можно с помощью файла requirements.txt

```bash
pip install -r requirements.txt
```
Пример работы пайплайна из задания 3
```python
# Импортируем всё необходимое для работы пайплайна
from AllStaff import *
# Устанавливаем режим модели распознавания (ArcFace/CE)
load_embedding_model(use_arcface=False)
# Запускаем функцию мэтчинга
matches = match_and_show_pairs(
    r"path_to_image_1.jpg",
    r"path_to_image_2.jpg",
    threshold=0.3 '''Ну тут по желанию, обе мои модели довольно плохи в сравнении
    лиц, однако при планке в районе 0.46 пользоваться CE моделью кое-как возможно'''
)
```

В результате запуска данного кода с вашими путями до изображений, будут отрисованы два исходных изображения и пары совпавших по мнению модели лиц с их косинусным сходством
## Для связи
tg - @Dance_of_the_God
